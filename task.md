# Whisper App é¡¹ç›®æ·±åº¦åˆ†ææŠ¥å‘Š

## é¡¹ç›®æ¦‚è¿°

**Whisper App** æ˜¯ä¸€ä¸ªåŸºäºAIçš„è¯­éŸ³è½¬å½•å’Œå†…å®¹è½¬æ¢Webåº”ç”¨ã€‚è¯¥é¡¹ç›®åˆ©ç”¨OpenAIçš„Whisperæ¨¡å‹è¿›è¡Œè¯­éŸ³è½¬å½•ï¼Œå¹¶é€šè¿‡å¤§è¯­è¨€æ¨¡å‹å°†è½¬å½•å†…å®¹è½¬æ¢ä¸ºå„ç§æ ¼å¼ï¼ˆæ‘˜è¦ã€åšå®¢ã€é‚®ä»¶ã€åˆ—è¡¨ç­‰ï¼‰ã€‚

### æ ¸å¿ƒåŠŸèƒ½
- ğŸ¤ è¯­éŸ³å½•åˆ¶å’Œä¸Šä¼ 
- ğŸ“ AIè¯­éŸ³è½¬å½•ï¼ˆåŸºäºTogether.aiçš„Whisperæ¨¡å‹ï¼‰
- ğŸ”„ æ™ºèƒ½å†…å®¹è½¬æ¢ï¼ˆæ‘˜è¦ã€åšå®¢ã€é‚®ä»¶ã€å¿«é€Ÿç¬”è®°ã€åˆ—è¡¨ï¼‰
- ğŸ‘¥ ç”¨æˆ·è®¤è¯å’Œç®¡ç†
- ğŸ“Š ä½¿ç”¨é™åˆ¶å’Œè®¡è´¹ç®¡ç†
- ğŸ’¾ è½¬å½•å†å²è®°å½•ç®¡ç†

---

## å½“å‰æŠ€æœ¯æ ˆåˆ†æ

### å‰ç«¯æŠ€æœ¯æ ˆ
| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” | è¯„ä»· |
|------|------|------|------|
| **Next.js** | 15.2.4 | å…¨æ ˆReactæ¡†æ¶ | âœ… ä¼˜ç§€ - ç°ä»£åŒ–ï¼Œæ”¯æŒSSR/SSG |
| **React** | 19.0.0 | UIåº“ | âœ… ä¼˜ç§€ - æœ€æ–°ç‰ˆæœ¬ï¼Œç”Ÿæ€æˆç†Ÿ |
| **TypeScript** | 5.x | ç±»å‹å®‰å…¨ | âœ… ä¼˜ç§€ - æä¾›ç±»å‹å®‰å…¨ä¿éšœ |
| **Tailwind CSS** | 4.x | CSSæ¡†æ¶ | âœ… ä¼˜ç§€ - å¿«é€Ÿå¼€å‘ï¼Œé«˜åº¦å¯å®šåˆ¶ |
| **Radix UI** | å„ç»„ä»¶æœ€æ–°ç‰ˆ | UIç»„ä»¶åº“ | âœ… ä¼˜ç§€ - æ— éšœç¢æ€§å¥½ï¼Œé«˜è´¨é‡ç»„ä»¶ |

### åç«¯æŠ€æœ¯æ ˆ
| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” | è¯„ä»· |
|------|------|------|------|
| **tRPC** | 11.4.3 | ç±»å‹å®‰å…¨API | âœ… ä¼˜ç§€ - ç«¯åˆ°ç«¯ç±»å‹å®‰å…¨ |
| **Prisma** | 6.11.1 | ORM | âœ… ä¼˜ç§€ - ç°ä»£åŒ–ORMï¼Œç±»å‹å®‰å…¨ |
| **PostgreSQL** | - | æ•°æ®åº“ | âœ… ä¼˜ç§€ - æ€§èƒ½å¼ºï¼ŒåŠŸèƒ½ä¸°å¯Œ |

### ç¬¬ä¸‰æ–¹æœåŠ¡
| æœåŠ¡ | ç”¨é€” | è¯„ä»· |
|------|------|------|
| **Together.ai** | AIæ¨¡å‹æœåŠ¡ | âœ… ä¼˜ç§€ - æ€§ä»·æ¯”é«˜ï¼Œæ”¯æŒå¤šç§æ¨¡å‹ |
| **Clerk** | ç”¨æˆ·è®¤è¯ | âœ… ä¼˜ç§€ - åŠŸèƒ½å…¨é¢ï¼Œæ˜“äºé›†æˆ |
| **AWS S3** | æ–‡ä»¶å­˜å‚¨ | âœ… ä¼˜ç§€ - å¯é æ€§é«˜ï¼Œæˆæœ¬å¯æ§ |
| **Upstash Redis** | é™æµç¼“å­˜ | âœ… ä¼˜ç§€ - æ— æœåŠ¡å™¨Redisï¼Œæ˜“äºä½¿ç”¨ |
| **Neon** | PostgreSQLæ‰˜ç®¡ | âœ… ä¼˜ç§€ - ç°ä»£åŒ–PGæ‰˜ç®¡æœåŠ¡ |
| **Vercel** | éƒ¨ç½²æ‰˜ç®¡ | âœ… ä¼˜ç§€ - ä¸Next.jså®Œç¾é›†æˆ |

---

## æŠ€æœ¯æ ˆåˆç†æ€§è¯„ä¼°

### âœ… ä¼˜åŠ¿åˆ†æ

1. **æŠ€æœ¯å…ˆè¿›æ€§**
   - ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„React 19å’ŒNext.js 15
   - é‡‡ç”¨App Routeræ¶æ„ï¼Œæ€§èƒ½æ›´ä¼˜
   - å…¨æ ˆTypeScriptä¿è¯ç±»å‹å®‰å…¨

2. **å¼€å‘æ•ˆç‡**
   - tRPCæä¾›ç«¯åˆ°ç«¯ç±»å‹å®‰å…¨
   - Prisma ORMç®€åŒ–æ•°æ®åº“æ“ä½œ
   - Tailwind CSS + Radix UIå¿«é€Ÿæ„å»ºç°ä»£UI

3. **å¯æ‰©å±•æ€§**
   - æ¨¡å—åŒ–æ¶æ„è®¾è®¡
   - å¾®æœåŠ¡åŒ–çš„ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆ
   - æ¸…æ™°çš„æ•°æ®æ¨¡å‹è®¾è®¡

4. **ç”¨æˆ·ä½“éªŒ**
   - å®æ—¶æµå¼å“åº”
   - ç°ä»£åŒ–UI/UXè®¾è®¡
   - å“åº”å¼è®¾è®¡æ”¯æŒå¤šè®¾å¤‡

### âš ï¸ æ½œåœ¨é—®é¢˜

1. **ä¾›åº”å•†ä¾èµ–**
   - è¿‡åº¦ä¾èµ–ç¬¬ä¸‰æ–¹æœåŠ¡ï¼ˆTogether.ai, Clerk, Neonç­‰ï¼‰
   - å¦‚æœæœåŠ¡ä¸­æ–­æˆ–æ¶¨ä»·ä¼šå½±å“ä¸šåŠ¡è¿ç»­æ€§

2. **æˆæœ¬æ§åˆ¶**
   - AIæ¨ç†æˆæœ¬éšç”¨æˆ·å¢é•¿çº¿æ€§å¢åŠ 
   - å¤šä¸ªä»˜è´¹æœåŠ¡å åŠ æˆæœ¬è¾ƒé«˜

3. **æœ¬åœ°åŒ–éƒ¨ç½²æŒ‘æˆ˜**
   - å½“å‰æ¶æ„é«˜åº¦ä¾èµ–äº‘æœåŠ¡
   - Windowsæœ¬åœ°éƒ¨ç½²éœ€è¦å¤§é‡æ”¹é€ 

---

## Windowsæœ¬åœ°éƒ¨ç½²å…¼å®¹æ€§åˆ†æ

### ğŸ”´ å½“å‰æ¶æ„çš„Windowséƒ¨ç½²æŒ‘æˆ˜

1. **å¤–éƒ¨æœåŠ¡ä¾èµ–**
   - Together.aiï¼šéœ€è¦APIå¯†é’¥ï¼Œæ— æ³•æœ¬åœ°åŒ–
   - Clerkï¼šèº«ä»½è®¤è¯æœåŠ¡ï¼Œä¾èµ–å¤–éƒ¨
   - AWS S3ï¼šæ–‡ä»¶å­˜å‚¨ï¼Œéœ€è¦äº‘æœåŠ¡
   - Upstash Redisï¼šç¼“å­˜æœåŠ¡ï¼Œä¾èµ–äº‘ç«¯

2. **æ•°æ®åº“ä¾èµ–**
   - å½“å‰ä½¿ç”¨Neonæ‰˜ç®¡PostgreSQL
   - éœ€è¦æœ¬åœ°PostgreSQLå®ä¾‹

### âœ… å¯è¡Œçš„Windowsæœ¬åœ°éƒ¨ç½²æ–¹æ¡ˆ

**æ–¹æ¡ˆAï¼šå®¹å™¨åŒ–éƒ¨ç½²**
```bash
# ä½¿ç”¨Docker Composeä¸€é”®éƒ¨ç½²
docker-compose up -d
```

**æ–¹æ¡ˆBï¼šåŸç”ŸWindowséƒ¨ç½²**
```bash
# å®‰è£…ä¾èµ–
npm install -g pnpm
pnpm install

# å¯åŠ¨æœ¬åœ°æœåŠ¡
npm run dev
```

---

## æ¨èçš„Windowsæœ¬åœ°éƒ¨ç½²æŠ€æœ¯æ ˆ

### ğŸ¯ ä¼˜åŒ–æ–¹æ¡ˆï¼šæ··åˆæ¶æ„

#### æ ¸å¿ƒä¿ç•™æŠ€æœ¯
- âœ… **Next.js + React + TypeScript**ï¼šå‰ç«¯æŠ€æœ¯æ ˆä¿æŒä¸å˜
- âœ… **Tailwind CSS + Radix UI**ï¼šUIæŠ€æœ¯æ ˆä¿æŒä¸å˜
- âœ… **tRPC + Prisma**ï¼šåç«¯æ¶æ„ä¿æŒä¸å˜

#### æ›¿æ¢å»ºè®®

| åŸæœåŠ¡ | Windowsæœ¬åœ°æ›¿ä»£æ–¹æ¡ˆ | ä¼˜åŠ¿ |
|--------|-------------------|------|
| **Together.ai** | **Ollama + æœ¬åœ°Whisper** | å®Œå…¨ç¦»çº¿ï¼Œæ•°æ®ç§å¯† |
| **Clerk** | **NextAuth.js + æœ¬åœ°æ•°æ®åº“** | å¼€æºï¼Œå®Œå…¨å¯æ§ |
| **AWS S3** | **æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ + MinIO** | æœ¬åœ°å­˜å‚¨ï¼Œå…¼å®¹S3 API |
| **Upstash Redis** | **æœ¬åœ°Redis Server** | åŸç”ŸWindowsæ”¯æŒ |
| **Neon** | **æœ¬åœ°PostgreSQL** | å®Œå…¨æœ¬åœ°åŒ– |

### ğŸ”§ å…·ä½“å®æ–½æ–¹æ¡ˆ

#### 1. AIæœåŠ¡æœ¬åœ°åŒ–
```typescript
// ä½¿ç”¨æœ¬åœ°Whisperæ¨¡å‹
import { spawn } from 'child_process';

async function transcribeLocal(audioPath: string) {
  const whisper = spawn('whisper', [audioPath, '--model', 'base']);
  // å¤„ç†è¾“å‡º...
}

// æˆ–ä½¿ç”¨Ollamaè¿è¡Œæœ¬åœ°LLM
import ollama from 'ollama';

const response = await ollama.chat({
  model: 'llama3.1',
  messages: [{ role: 'user', content: prompt }],
  stream: true
});
```

#### 2. è®¤è¯ç³»ç»Ÿæ›¿æ¢
```typescript
// next-authé…ç½®
import NextAuth from 'next-auth';
import CredentialsProvider from 'next-auth/providers/credentials';

export default NextAuth({
  providers: [
    CredentialsProvider({
      // æœ¬åœ°è®¤è¯é€»è¾‘
    })
  ],
  database: process.env.DATABASE_URL, // æœ¬åœ°PostgreSQL
});
```

#### 3. æ–‡ä»¶å­˜å‚¨æœ¬åœ°åŒ–
```typescript
// ä½¿ç”¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿæˆ–MinIO
import { MinIO } from 'minio';

const minioClient = new MinIO.Client({
  endPoint: 'localhost',
  port: 9000,
  useSSL: false,
  accessKey: 'minioadmin',
  secretKey: 'minioadmin'
});
```

### ğŸ“¦ æ¨èéƒ¨ç½²æ–¹æ¡ˆ

#### Docker Composeé…ç½®
```yaml
version: '3.8'
services:
  app:
    build: .
    ports:
      - "3000:3000"
    depends_on:
      - postgres
      - redis
      - minio
      - ollama

  postgres:
    image: postgres:15
    environment:
      POSTGRES_DB: whisper
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
    volumes:
      - postgres_data:/var/lib/postgresql/data

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"

  minio:
    image: minio/minio
    command: server /data --console-address ":9001"
    ports:
      - "9000:9000"
      - "9001:9001"
    volumes:
      - minio_data:/data

  ollama:
    image: ollama/ollama
    ports:
      - "11434:11434"
    volumes:
      - ollama_data:/root/.ollama

volumes:
  postgres_data:
  minio_data:
  ollama_data:
```

---

## å®æ–½è·¯çº¿å›¾

### é˜¶æ®µ1ï¼šç¯å¢ƒå‡†å¤‡ï¼ˆ1-2å¤©ï¼‰
- [ ] å®‰è£…Docker Desktop for Windows
- [ ] é…ç½®æœ¬åœ°PostgreSQL
- [ ] è®¾ç½®RedisæœåŠ¡
- [ ] å®‰è£…Ollamaå¹¶ä¸‹è½½æ¨¡å‹

### é˜¶æ®µ2ï¼šæœåŠ¡æ›¿æ¢ï¼ˆ3-5å¤©ï¼‰
- [ ] æ›¿æ¢Clerkä¸ºNextAuth.js
- [ ] é…ç½®æœ¬åœ°æ–‡ä»¶å­˜å‚¨ï¼ˆMinIOï¼‰
- [ ] é›†æˆæœ¬åœ°Whisperæ¨¡å‹
- [ ] é…ç½®æœ¬åœ°LLMæœåŠ¡

### é˜¶æ®µ3ï¼šæµ‹è¯•ä¼˜åŒ–ï¼ˆ2-3å¤©ï¼‰
- [ ] ç«¯åˆ°ç«¯åŠŸèƒ½æµ‹è¯•
- [ ] æ€§èƒ½ä¼˜åŒ–è°ƒè¯•
- [ ] å®‰å…¨é…ç½®æ£€æŸ¥
- [ ] æ–‡æ¡£æ›´æ–°

### é˜¶æ®µ4ï¼šéƒ¨ç½²æ‰“åŒ…ï¼ˆ1-2å¤©ï¼‰
- [ ] åˆ›å»ºDockeré•œåƒ
- [ ] ç¼–å†™éƒ¨ç½²è„šæœ¬
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•
- [ ] ç”¨æˆ·æ‰‹å†Œç¼–å†™

---

## æˆæœ¬æ•ˆç›Šåˆ†æ

### äº‘ç«¯æ–¹æ¡ˆï¼ˆå½“å‰ï¼‰
- **æœˆåº¦æˆæœ¬**ï¼š$50-200ï¼ˆéšä½¿ç”¨é‡å¢é•¿ï¼‰
- **ç»´æŠ¤æˆæœ¬**ï¼šä½
- **æ‰©å±•æ€§**ï¼šä¼˜ç§€
- **æ•°æ®éšç§**ï¼šä¾èµ–æœåŠ¡å•†

### æœ¬åœ°éƒ¨ç½²æ–¹æ¡ˆï¼ˆæ¨èï¼‰
- **ä¸€æ¬¡æ€§æˆæœ¬**ï¼šå¼€å‘æ—¶é—´æŠ•å…¥
- **è¿è¡Œæˆæœ¬**ï¼šç¡¬ä»¶ç”µè´¹
- **ç»´æŠ¤æˆæœ¬**ï¼šä¸­ç­‰
- **æ•°æ®éšç§**ï¼šå®Œå…¨å¯æ§

---

## æ€»ç»“ä¸å»ºè®®

### ğŸ¯ æ ¸å¿ƒå»ºè®®

1. **ä¿æŒç°æœ‰æ¶æ„ä¼˜åŠ¿**ï¼šNext.js + TypeScript + tRPCçš„æŠ€æœ¯æ ˆéå¸¸ä¼˜ç§€ï¼Œå»ºè®®ä¿ç•™

2. **æ¸è¿›å¼æœ¬åœ°åŒ–**ï¼šä¸å»ºè®®ä¸€æ¬¡æ€§å®Œå…¨é‡æ„ï¼Œå¯ä»¥åˆ†é˜¶æ®µæ›¿æ¢æœåŠ¡

3. **æ··åˆéƒ¨ç½²æ¨¡å¼**ï¼šè€ƒè™‘äº‘ç«¯+æœ¬åœ°çš„æ··åˆæ¶æ„ï¼Œå¹³è¡¡æˆæœ¬å’Œæ€§èƒ½

4. **å®¹å™¨åŒ–éƒ¨ç½²**ï¼šä½¿ç”¨Dockerç¡®ä¿Windowsç¯å¢ƒçš„ä¸€è‡´æ€§å’Œå¯ç§»æ¤æ€§

### ğŸš€ æœ€ä¼˜æŠ€æœ¯æ ˆç»„åˆï¼ˆWindowsæœ¬åœ°éƒ¨ç½²ï¼‰

```
å‰ç«¯ï¼šNext.js 15 + React 19 + TypeScript + Tailwind CSS
åç«¯ï¼štRPC + Prisma + NextAuth.js
æ•°æ®åº“ï¼šPostgreSQL + Redis
AIæœåŠ¡ï¼šOllama + æœ¬åœ°Whisperæ¨¡å‹
æ–‡ä»¶å­˜å‚¨ï¼šMinIOï¼ˆS3å…¼å®¹ï¼‰
éƒ¨ç½²ï¼šDocker Compose
```

è¿™ä¸ªæŠ€æœ¯æ ˆåœ¨ä¿æŒç°ä»£åŒ–å’Œé«˜æ€§èƒ½çš„åŒæ—¶ï¼Œå®ç°äº†å®Œå…¨çš„æœ¬åœ°éƒ¨ç½²èƒ½åŠ›ï¼Œç‰¹åˆ«é€‚åˆå¯¹æ•°æ®éšç§æœ‰è¦æ±‚çš„ä¼ä¸šç”¨æˆ·ã€‚

---

---

## ğŸ¯ æœ¬åœ°AIæ¨¡å‹æ¨èé…ç½®

### Whisperè¯­éŸ³è½¬å½•æ¨¡å‹

#### OpenAI Whisperå®˜æ–¹æ¨¡å‹æ¨è
```bash
# å®‰è£…Whisper
pip install openai-whisper

# æ¨èæ¨¡å‹é€‰æ‹©
whisper audio.mp3 --model medium    # æœ€ä½³å¹³è¡¡ç‚¹ï¼ˆæ¨èï¼‰
whisper audio.mp3 --model base      # é€Ÿåº¦ä¼˜å…ˆ
whisper audio.mp3 --model large-v3  # ç²¾åº¦ä¼˜å…ˆ
```

| æ¨¡å‹ | å¤§å° | é€Ÿåº¦ | ç²¾åº¦ | æ¨èåœºæ™¯ | ç¡¬ä»¶è¦æ±‚ |
|------|------|------|------|----------|----------|
| **medium** | ~769MB | â­â­â­â­ | â­â­â­â­ | **æœ€ä½³å¹³è¡¡** | 8GB+ RAM |
| base | ~142MB | â­â­â­â­â­ | â­â­â­ | å¿«é€Ÿè½¬å½• | 4GB+ RAM |
| large-v3 | ~1550MB | â­â­ | â­â­â­â­â­ | é«˜ç²¾åº¦éœ€æ±‚ | 16GB+ RAM |

#### Faster-Whisperï¼ˆå¼ºçƒˆæ¨èï¼‰
```bash
# æ›´é«˜æ•ˆçš„Whisperå®ç°
pip install faster-whisper

# Pythoné›†æˆç¤ºä¾‹
from faster_whisper import WhisperModel

model = WhisperModel("medium", device="cpu", compute_type="int8")
segments, info = model.transcribe("audio.mp3", language="zh")
```
**ä¼˜åŠ¿**ï¼šæ¯”å®˜æ–¹Whisperå¿«4-5å€ï¼Œå†…å­˜å ç”¨å°‘50%

### Ollamaå¤§è¯­è¨€æ¨¡å‹æ¨è

#### æ ¸å¿ƒLLMæ¨¡å‹é…ç½®

**1. Llama 3.1 8B**ï¼ˆä¸»åŠ›æ¨èï¼‰
```bash
ollama pull llama3.1:8b
```
- **ç”¨é€”**ï¼šæ–‡æœ¬è½¬æ¢ã€æ‘˜è¦ã€æ ¼å¼åŒ–
- **ä¼˜åŠ¿**ï¼šä¸­è‹±æ–‡æ”¯æŒä¼˜ç§€ï¼Œé€Ÿåº¦å¿«ï¼Œè´¨é‡é«˜
- **ç¡¬ä»¶è¦æ±‚**ï¼š8GB+ RAM
- **é€‚åˆåœºæ™¯**ï¼šé€šç”¨æ–‡æœ¬å¤„ç†ï¼Œå¤šè¯­è¨€æ”¯æŒ

**2. Qwen2.5 7B**ï¼ˆä¸­æ–‡ç‰¹åŒ–ï¼‰
```bash
ollama pull qwen2.5:7b
```
- **ç”¨é€”**ï¼šä¸“é—¨å¤„ç†ä¸­æ–‡å†…å®¹è½¬æ¢
- **ä¼˜åŠ¿**ï¼šä¸­æ–‡ç†è§£èƒ½åŠ›æå¼ºï¼Œå›½äº§åŒ–
- **é€‚åˆåœºæ™¯**ï¼šä¸­æ–‡è¯­éŸ³è½¬å½•åå¤„ç†

**3. Gemma2 9B**ï¼ˆè½»é‡é«˜æ•ˆï¼‰
```bash
ollama pull gemma2:9b
```
- **ç”¨é€”**ï¼šè½»é‡çº§æ–‡æœ¬å¤„ç†
- **ä¼˜åŠ¿**ï¼šGoogleå‡ºå“ï¼Œæ•ˆç‡é«˜ï¼Œèµ„æºå ç”¨å°‘
- **é€‚åˆåœºæ™¯**ï¼šèµ„æºå—é™ç¯å¢ƒ

### ç¡¬ä»¶é…ç½®å»ºè®®

#### 8GB RAMç³»ç»Ÿ
```bash
# æ¨èé…ç½®
Whisper: base æˆ– small
LLM: llama3.1:8b æˆ– gemma2:7b
```

#### 16GB RAMç³»ç»Ÿï¼ˆæœ€ä½³é…ç½®ï¼‰
```bash
# æ¨èé…ç½®
Whisper: mediumï¼ˆæœ€ä½³å¹³è¡¡ï¼‰
LLM: llama3.1:8b + qwen2.5:7bï¼ˆåŒæ¨¡å‹ï¼‰
```

#### 32GB+ RAMç³»ç»Ÿ
```bash
# é«˜æ€§èƒ½é…ç½®
Whisper: large-v3
LLM: llama3.1:70bï¼ˆæœ€é«˜è´¨é‡ï¼‰
```

---

## ğŸ”§ æœ¬åœ°æ¨¡å‹é›†æˆä»£ç 

### 1. Whisperæœ¬åœ°è½¬å½•é›†æˆ

**æ›¿æ¢Together.aiæœåŠ¡**ï¼ˆapp/api/transform/route.tsï¼‰ï¼š

```typescript
// åŸä»£ç æ›¿æ¢
import { WhisperModel } from 'faster-whisper';

// åˆå§‹åŒ–æœ¬åœ°Whisperæ¨¡å‹
const whisperModel = new WhisperModel("medium", {
  device: "cpu",
  compute_type: "int8"
});

// æœ¬åœ°è½¬å½•å‡½æ•°
async function transcribeLocal(audioPath: string, language?: string) {
  const segments = await whisperModel.transcribe(audioPath, {
    language: language || "auto",
    word_timestamps: true,
    vad_filter: true, // è¯­éŸ³æ´»åŠ¨æ£€æµ‹
  });
  
  return {
    fullTranscription: segments.map(s => s.text).join(' '),
    segments: segments,
    language: segments.language
  };
}
```

### 2. Ollamaæœ¬åœ°LLMé›†æˆ

```typescript
// æœ¬åœ°LLMè½¬æ¢æœåŠ¡
import ollama from 'ollama';

async function transformWithOllama(transcription: string, typeName: string) {
  const prompts = {
    summary: `è¯·å°†ä»¥ä¸‹è½¬å½•å†…å®¹æ€»ç»“ä¸º100å­—ä»¥å†…çš„æ‘˜è¦ï¼Œä¿æŒåŸè¯­è¨€ï¼š\n\n${transcription}`,
    'quick-note': `è¯·å°†ä»¥ä¸‹è½¬å½•å†…å®¹æ•´ç†ä¸ºç®€æ´çš„ä¾¿ç­¾æ ¼å¼ï¼š\n\n${transcription}`,
    list: `è¯·å°†ä»¥ä¸‹è½¬å½•å†…å®¹æå–å…³é”®ç‚¹å¹¶æ•´ç†ä¸ºæ¡ç›®åˆ—è¡¨ï¼š\n\n${transcription}`,
    blog: `è¯·å°†ä»¥ä¸‹è½¬å½•å†…å®¹æ•´ç†ä¸ºä¸€ç¯‡ç»“æ„æ¸…æ™°çš„åšå®¢æ–‡ç« ï¼ŒåŒ…å«æ ‡é¢˜å’Œæ®µè½ï¼š\n\n${transcription}`,
    email: `è¯·å°†ä»¥ä¸‹è½¬å½•å†…å®¹æ•´ç†ä¸ºä¸€å°æ­£å¼é‚®ä»¶ï¼ŒåŒ…å«ä¸»é¢˜è¡Œå’Œæ­£æ–‡ï¼š\n\n${transcription}`
  };

  // æ ¹æ®å†…å®¹è¯­è¨€é€‰æ‹©æ¨¡å‹
  const isChineseContent = /[\u4e00-\u9fa5]/.test(transcription);
  const model = isChineseContent ? 'qwen2.5:7b' : 'llama3.1:8b';

  const response = await ollama.chat({
    model: model,
    messages: [{ role: 'user', content: prompts[typeName] }],
    stream: true,
    options: {
      temperature: 0.7,
      max_tokens: 2000
    }
  });

  return response;
}
```

### 3. æ–‡ä»¶å­˜å‚¨æœ¬åœ°åŒ–

```typescript
// æ›¿æ¢S3ä¸Šä¼ ä¸ºæœ¬åœ°å­˜å‚¨
import { promises as fs } from 'fs';
import path from 'path';

const UPLOAD_DIR = './uploads';

async function saveAudioLocally(file: File): Promise<string> {
  const fileName = `${Date.now()}-${file.name}`;
  const filePath = path.join(UPLOAD_DIR, fileName);
  
  // ç¡®ä¿ä¸Šä¼ ç›®å½•å­˜åœ¨
  await fs.mkdir(UPLOAD_DIR, { recursive: true });
  
  // ä¿å­˜æ–‡ä»¶
  const buffer = Buffer.from(await file.arrayBuffer());
  await fs.writeFile(filePath, buffer);
  
  return filePath;
}
```

---

## ğŸ“¦ å®Œæ•´æœ¬åœ°éƒ¨ç½²Dockeré…ç½®

### docker-compose.yml
```yaml
version: '3.8'
services:
  whisper-app:
    build: .
    ports:
      - "3000:3000"
    depends_on:
      - postgres
      - redis  
      - ollama
    volumes:
      - ./uploads:/app/uploads
      - ./whisper-models:/app/models
    environment:
      - DATABASE_URL=postgresql://whisper:password@postgres:5432/whisper
      - REDIS_URL=redis://redis:6379
      - OLLAMA_HOST=http://ollama:11434

  ollama:
    image: ollama/ollama:latest
    ports:
      - "11434:11434"
    volumes:
      - ollama_models:/root/.ollama
    environment:
      - OLLAMA_HOST=0.0.0.0
    # GPUæ”¯æŒï¼ˆå¯é€‰ï¼‰
    # deploy:
    #   resources:
    #     reservations:
    #       devices:
    #         - driver: nvidia
    #           count: 1
    #           capabilities: [gpu]

  postgres:
    image: postgres:15
    environment:
      POSTGRES_DB: whisper
      POSTGRES_USER: whisper
      POSTGRES_PASSWORD: password
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"

volumes:
  ollama_models:
  postgres_data:
```

### å¿«é€Ÿå¯åŠ¨è„šæœ¬ï¼ˆsetup-local.shï¼‰
```bash
#!/bin/bash
echo "ğŸš€ å¯åŠ¨æœ¬åœ°Whisperåº”ç”¨..."

# 1. å¯åŠ¨DockeræœåŠ¡
echo "å¯åŠ¨Dockerå®¹å™¨..."
docker-compose up -d

# 2. ç­‰å¾…æœåŠ¡å¯åŠ¨
echo "ç­‰å¾…æœåŠ¡å¯åŠ¨..."
sleep 15

# 3. ä¸‹è½½æ¨èAIæ¨¡å‹
echo "ä¸‹è½½Ollamaæ¨¡å‹..."
docker exec whisper-ollama-1 ollama pull llama3.1:8b
docker exec whisper-ollama-1 ollama pull qwen2.5:7b

# 4. å®‰è£…Python Whisperä¾èµ–
echo "å®‰è£…Whisperä¾èµ–..."
pip install faster-whisper

# 5. æ•°æ®åº“åˆå§‹åŒ–
echo "åˆå§‹åŒ–æ•°æ®åº“..."
docker exec whisper-whisper-app-1 npm run db:push

echo "âœ… æœ¬åœ°éƒ¨ç½²å®Œæˆï¼"
echo "ğŸŒ è®¿é—®åœ°å€: http://localhost:3000"
echo "ğŸ—„ï¸  æ•°æ®åº“ç®¡ç†: http://localhost:3000/api/studio"
echo "ğŸ¤– Ollama API: http://localhost:11434"
```

### ç¯å¢ƒå˜é‡é…ç½®ï¼ˆ.env.localï¼‰
```bash
# æ•°æ®åº“é…ç½®
DATABASE_URL="postgresql://whisper:password@localhost:5432/whisper"

# Redisé…ç½®
REDIS_URL="redis://localhost:6379"

# Ollamaé…ç½®
OLLAMA_HOST="http://localhost:11434"

# æœ¬åœ°æ–‡ä»¶å­˜å‚¨
UPLOAD_PATH="./uploads"
WHISPER_MODEL_PATH="./models"

# è®¤è¯é…ç½®ï¼ˆå¦‚ä½¿ç”¨NextAuth.jsï¼‰
NEXTAUTH_SECRET="your-secret-key"
NEXTAUTH_URL="http://localhost:3000"

# åº”ç”¨é…ç½®
NODE_ENV="development"
```

---

## ğŸ¯ æ¨¡å‹é€‰æ‹©å†³ç­–æŒ‡å—

### åœºæ™¯åŒ–æ¨è

**ä¸­æ–‡ä¸ºä¸»çš„åº”ç”¨**ï¼š
```bash
# æœ€ä½³é…ç½®
Whisper: medium (æŒ‡å®š language="zh")
LLM: qwen2.5:7b
å¤‡ç”¨: llama3.1:8b
```

**è‹±æ–‡ä¸ºä¸»çš„åº”ç”¨**ï¼š
```bash
# æœ€ä½³é…ç½®  
Whisper: medium
LLM: llama3.1:8b
å¤‡ç”¨: gemma2:9b
```

**å¤šè¯­è¨€æ··åˆåº”ç”¨**ï¼š
```bash
# é€šç”¨é…ç½®
Whisper: large-v3 (è‡ªåŠ¨æ£€æµ‹è¯­è¨€)
LLM: llama3.1:8b (å¤šè¯­è¨€æ”¯æŒå¥½)
```

**èµ„æºå—é™ç¯å¢ƒ**ï¼š
```bash
# è½»é‡é…ç½®
Whisper: base
LLM: gemma2:7b
```

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **å¯ç”¨é‡åŒ–**ï¼šä½¿ç”¨int8é‡åŒ–å‡å°‘å†…å­˜å ç”¨
2. **æ‰¹å¤„ç†**ï¼šæ”¯æŒå¤šæ–‡ä»¶å¹¶è¡Œè½¬å½•
3. **ç¼“å­˜ç­–ç•¥**ï¼šå¸¸ç”¨æ¨¡å‹ä¿æŒå†…å­˜é©»ç•™
4. **GPUåŠ é€Ÿ**ï¼šæœ‰æ¡ä»¶æ—¶å¯ç”¨CUDAæ”¯æŒ

---

*æŠ¥å‘Šç”Ÿæˆæ—¶é—´ï¼š2025-08-01*
*é¡¹ç›®ç‰ˆæœ¬ï¼š0.1.0*